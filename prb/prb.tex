\makeatletter

\title{\ntitle \\ \vspace*{20pt} {\normalsize -Problem set-}}
\author{\small\nauthor}


\let\@@section\section
\renewcommand\section{\setcounter{prb}{0}\newpage\@@section}
\let\@@subsection\subsection
\renewcommand\subsection[1]
{
  \vspace*{5pt}\@@subsection*{#1}\vspace*{-15pt}
  \addcontentsline{toc}{subsection}{#1}
}








\usepackage{xparse}
\newcounter{prb}
\newcommand\prblabel{{\bfseries\large\arabic{section}.\arabic{prb}.\hspace*{5pt}}}
\newcounter{ques}
\newcommand\queslabel{\llap{(\alph{ques})\hspace*{5pt}}}

\usepackage{changepage}

\DeclareDocumentEnvironment{prb}{+o}
{
  \begin{adjustwidth}{0pt}{}
  \IfNoValueTF{#1}{}
  {
    \setcounter{ques}{0}
    \stepcounter{prb}
    \par\vspace{20pt}
    \noindent\prblabel\emph{\large#1.}
  }
  \par\vspace*{5pt}
}{\end{adjustwidth}}

\DeclareDocumentEnvironment{sol}{}
{
  \begin{adjustwidth}{0pt}{}
  \setcounter{ques}{0}
  \par\vspace{5pt}
  $Solution.$
}{\end{adjustwidth}}


\DeclareDocumentCommand{\q}{}
{
  \end{adjustwidth}
  \stepcounter{ques}
  \par%\vspace{0pt}
  \begin{adjustwidth}{30pt}{}
  \noindent\queslabel
}

\DeclareDocumentCommand{\mtprb}{}
{
  This is an empty problem.
  A quadratic function is defined by \[f(x)=ax^2+bx+c\] where $a,b,c$ are real numbers.
  \q Show that the equation $f(x)=0$ has a real solution if and only if $b^2-4ac\ge0$.
  \q Find the formula of solutions.
}


\usepackage{fancyhdr}
\pagestyle{fancyplain}
\lhead{\nouppercase{\leftmark}}
\rhead{\nouppercase{\ntitle: Problem set}}



\makeatother













\iffalse
%tcolorbox
\definecolor{lightgray}{RGB}{216,216,216}
\newtcolorbox[
  auto counter,
  number within=section
]{prob}[1][]{
  breakable,
  enhanced,
  %
  colbacktitle=white,
  colback=white,
  colframe=lightgray,
  %
  leftrule=0pt,
  rightrule=0pt,
  toprule=2pt,
  bottomrule=2pt,
  titlerule=0pt,
  %
  arc=0pt,
  boxsep=4pt,
  top=12pt,
  before upper={\parindent15pt},
  before={\vspace*{20pt}},
  after={\vspace*{12pt}},
  %
  title=\quad#1\quad,
  fonttitle=\color{black}\sffamily\bfseries\large,
  attach boxed title to top left={xshift=90pt, yshift=-8pt},
  boxed title style={
    enhanced,
    size=small,
    colback=white,
    colframe=white,
    arc=0pt},
  %
  overlay={
    \node[
      outer sep=0pt,
      anchor=east,
      text width=2.6cm,
      minimum height=4ex,
      fill=lightgray,
      font=\color{black}\sffamily\scshape
    ] at (title.west) {\hspace*{1.5pt} Problem~\thetcbcounter};
  }
}
\newcommand\Solution{\par\textbf{\textsf{Solution}}\par\medskip}
\fi